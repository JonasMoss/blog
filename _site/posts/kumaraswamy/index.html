<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jonas Moss">

<title>Jonas Moss’ blog - Matching quantiles to the Kumaraswamy distribution</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jonas Moss’ blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JonasMoss"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Matching quantiles to the Kumaraswamy distribution</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">effective altruism</div>
                <div class="quarto-category">forecasting</div>
                <div class="quarto-category">statistics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jonas Moss </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Feb 24, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Sometimes, in particular when doing informal forecasting, you would like to match quantiles to distributions. For real data, the most common choice is the normal distribution. For positive data with “multiplicative qualities”, so to speak, the most common choice is the log-normal, but the truncated normal can also be reasonable. But what should you do when dealing with data on the <span class="math inline">\([0,1]\)</span>?</p>
<p>Distributions of (transformed) location-scale families are easy to match quantiles to, involving only algebraic manipulations with the cumulative distribution function. And there are infinitely many transformed location-scale families living on <span class="math inline">\([0,1]\)</span>: For any location-scale family distribution <span class="math inline">\(X\)</span>, such as the normal, and cumulative distribution function <span class="math inline">\(G\)</span> (on <span class="math inline">\(\mathbb{R}\)</span>), you can define the transformed family <span class="math inline">\(G(\mu + \sigma X)\)</span>, living on <span class="math inline">\([0,1]\)</span>. Then you can then match quantiles to the original family by mapping <span class="math inline">\(x\to G^{-1}(x)\)</span> and <span class="math inline">\(y\to G^{-1}(y)\)</span>. The most natural candidate here is, perhaps, the <a href="https://en.wikipedia.org/wiki/Logit-normal_distribution">logit-normal</a>. These distributions sometimes have poor looks, see e.g., the plot in the linked article, but could be an excellent choice.</p>
<p>Aside from transformed location-scale families, the most obvious way would be to match quantiles using the <a href="https://en.wikipedia.org/wiki/Beta_distribution">beta distribution</a>. But the beta distribution has a troublesome cumulative distribution function that is not available in every programming language. Moreover, for the beta distribution, matching quantiles is not a simple algebraic manipulation. Instead, you need to do numerical optimization. This increases the complexity of the procedure, both in terms of resources consumed and reliability, as it is hard to make sure the numerical optimization works all the time.</p>
<p>In this post I describe how to efficiently match quantiles for the <a href="https://en.wikipedia.org/wiki/Kumaraswamy_distribution">Kumaraswamy distribution</a>. The Kumaraswamy distribution is visually indistinguishable from the Beta distribution, but is sometimes easier to work with mathematically. In particular, the cumulative distribution function of a Kumaraswamy distribution with parameters <span class="math inline">\(a,b\)</span> is <span class="math inline">\(F(x;a,b) = 1-(1-x^a)^b\)</span>. Compare this to the Beta distribution, whose cumulative distribution function is the <a href="https://en.wikipedia.org/wiki/Beta_function#Incomplete_beta_function">incomplete regularized beta function</a> - the difference in complexity is striking. The Kumaraswamy distribution has some downsides though, most notably that the rôles of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> aren’t symmetric. In other words, so you can’t be sure that the Kumaraswamy with equal <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> parameters is symmetric. Moreover, it’s not a conjugate distribution for the binomial, and the expectations doesn’t have as simple closed form as the beta distribution.</p>
<p>But if your goal is to match quantiles to a general purpose and reasonable-looking distribution, then look no further!</p>
</section>
<section id="doing-the-matching" class="level2">
<h2 class="anchored" data-anchor-id="doing-the-matching">Doing the matching</h2>
<p>We’ll do the matching using Newton–Raphson, but first we’ll cover the following steps:</p>
<ol type="1">
<li><strong>Reduce the number of equations.</strong> By finding an expression for <span class="math inline">\(b\)</span> in terms of <span class="math inline">\(a\)</span>, we can reduce the problem from a two-dimensional Newton–Raphson to a one-dimensional Newton–Raphson.</li>
<li><strong>Do a rough analysis of the objective function.</strong> A rough analysis of the objective function suggests a very natural starting value.</li>
<li><strong>Do Taylor expansions to prevent numerical instability.</strong> The objective function and its derivative are sometimes poorly behaved. We use Taylor expansions to prevent numerical instability.</li>
</ol>
<p>The resulting is a function <code>matchkumar(x,y,alpha,beta)</code> that is both fast and reasonably reliable.</p>
<section id="reduce-the-number-of-equations" class="level3">
<h3 class="anchored" data-anchor-id="reduce-the-number-of-equations">1. Reduce the number of equations</h3>
<p>The cumulative distribution function is <span class="math inline">\(F(x)=1-(1-x^{a})^{b}\)</span>. Suppose we want to match the quantiles <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> to <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. That’s equivalent to <span class="math display">\[\begin{eqnarray*}
F(x_{0}) &amp; = &amp; \alpha=1-(1-x^{a})^{b},\\
F(x_{1}) &amp; = &amp; \beta=1-(1-y^{a})^{b}.
\end{eqnarray*}\]</span> Now we need to solve for <span class="math inline">\(a,b\)</span>. To do this, we’ll first solve for <span class="math inline">\(b\)</span>, yielding <span class="math display">\[\begin{eqnarray*}
1-\alpha &amp; = &amp; (1-x^{a})^{b},\\
\log(1-\alpha) &amp; = &amp; b\log(1-x^{a}).
\end{eqnarray*}\]</span> Writing <span class="math inline">\(b\)</span> as a function of <span class="math inline">\(a\)</span>, we find <span class="math display">\[
b(a)=\frac{\log(1-\alpha)}{\log(1-x^{a})}.
\]</span> Now solve for <span class="math inline">\(a\)</span> and find <span class="math display">\[
a(b)=\frac{\log\left(1-(1-\beta)^{1/b}\right)}{\log(y)}.
\]</span> Plug in the definition of <span class="math inline">\(b(a)\)</span> into the definition of <span class="math inline">\(a(b)\)</span> to find <span class="math display">\[
a=\frac{\log\left(1-(1-\beta)^{\frac{\log(1-x^{a})}{\log(1-\alpha)}}\right)}{\log(y)}
\]</span> Our goal is to solve this equation for <span class="math inline">\(a\)</span>, then plug the result into <span class="math inline">\(b(a)\)</span> to find <span class="math inline">\(b\)</span>. But we can’t solve for <span class="math inline">\(b\)</span> analytically.</p>
<p>To do this, let’s define <span class="math display">\[
\delta=(1-\beta)^{1/\log(1-\alpha)},\quad g(a)=\delta^{\log(1-x^{a})},
\]</span> and we need to solve <span class="math display">\[
f(a)=a\log y-\log(1-g(a))=0.
\]</span> The derivative of this one is <span class="math display">\[
f'(a)=\log y-\log(x)\log\delta\frac{x^{a}g(a)}{(1-x^{a})(1-g(a))}.
\]</span></p>
</section>
<section id="function-analysis" class="level3">
<h3 class="anchored" data-anchor-id="function-analysis">2. Function analysis</h3>
<p>The function <span class="math inline">\(f(a)\)</span> has an oblique asymptote as <span class="math inline">\(a\to\infty\)</span>. Using Taylor expansions, one may verify that its slope is <span class="math inline">\(\log(y/x)\)</span> and its intercept <span class="math inline">\(-\log\log\delta.\)</span> In other words, <span class="math inline">\(\lim_{a\to\infty}f(a)-h(a)=0\)</span>, where <span class="math inline">\(h(a)=-\log\log\delta+\log(y/x)a\)</span>. From what I can see, <span class="math inline">\(h(a)\)</span> approximates <span class="math inline">\(f(a)\)</span> from below. This is handy, as it is guaranteed that <span class="math inline">\(f(a_{0})&gt;0\)</span>, where <span class="math inline">\(a_{0}=\log\log\delta/\log(y/x)\)</span> is the solution to <span class="math inline">\(h(a)=0\)</span>. This will typically provide an excellent starting point.</p>
</section>
<section id="taylor-approximations" class="level3">
<h3 class="anchored" data-anchor-id="taylor-approximations">3. Taylor approximations</h3>
<p>The function <span class="math inline">\(g(a)\)</span> is behaves poorly numerically when <span class="math inline">\(x^a\)</span> becomes small, as it gets to close to <span class="math inline">\(1\)</span> and promotes numerical instability. To fix this, we use Taylor approximations for <span class="math inline">\(f\)</span> and <span class="math inline">\(f'\)</span> when <span class="math inline">\(x^a\)</span> is sufficiently small.</p>
<p>The first-order Taylor expansion of <span class="math inline">\(\log(1-\delta^{\log(1-x^a)})\)</span> (around <span class="math inline">\(x^a=0\)</span>), used in <span class="math inline">\(f(a)\)</span>, is <span class="math display">\[
a\log x+\log\log\delta+\frac{1}{2}x^{a}(1-\log\delta)+O(x^{a})
\]</span></p>
<p>The first-order Taylor expansion of <span class="math inline">\(f'(x^a)\)</span> as a function of <span class="math inline">\(x^a\)</span> is <span class="math display">\[\log y - \log x \cdot \frac{1}{2}(1+\log\delta)x^a+O(x^{2a})\]</span> We will use these approximations when <span class="math inline">\(x^a&lt;4\cdot10^{-6}\)</span>.</p>
<p>In addition, we will employ several other tricks to ensure numerical stability.</p>
</section>
</section>
<section id="code-for-matchkumar" class="level2">
<h2 class="anchored" data-anchor-id="code-for-matchkumar">Code for <code>matchkumar</code></h2>
<p>Below is <code>R</code> code for <code>matchkumar</code>. The function does not use any R-specific functionality, so it should be easily portable to any language of your choosing, such as JavaScript, Rust, or Crystal. The vectorization used in the functions <code>f</code> and <code>f_deriv</code> below is not strictly necessary, as they are only called using scalar arguments.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_575b9162d0a60c2feb2e09603cfa4a5d">
<details>
<summary>Code for <code>matchkumar</code></summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Match quantiles for the Kumaraswamy distributon.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha,beta Upper and lower quantiles to match.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x,y Values at those quantiles.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param eps,iter_lim Used in the Newton-Raphson algorithm.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param bound When x^a is smaller than this bound, use first-order</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#'    Taylor approximation.</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return The  a and b parameters for the Kumaraswamy distribution so that</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'  extraDistr::qkumar(alpha, a, b) = x and</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'  extraDistr::qkumar(beta, a, b) = y</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>matchkumar <span class="ot">&lt;-</span> \(alpha, beta, x, y, <span class="at">eps =</span> <span class="fl">1e-04</span>, <span class="at">iter_lim =</span> <span class="dv">100</span>, <span class="at">bound =</span> <span class="fl">4e-6</span>) {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  log_y <span class="ot">&lt;-</span> <span class="fu">log</span>(y)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  log_x <span class="ot">&lt;-</span> <span class="fu">log</span>(x)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> \(x_a) (<span class="dv">1</span> <span class="sc">-</span> beta)<span class="sc">^</span>(<span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> x_a) <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> alpha))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  log_delta <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> alpha)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> \(a) {</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    f_taylor <span class="ot">&lt;-</span> \(a) {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      log_y <span class="sc">*</span> a <span class="sc">-</span> (a <span class="sc">*</span> <span class="fu">log</span>(x) <span class="sc">+</span> <span class="fu">log</span>(log_delta) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> x<span class="sc">^</span>a <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> log_delta))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    f_not_taylor <span class="ot">&lt;-</span> \(a) {</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      log_y <span class="sc">*</span> a <span class="sc">-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">g</span>(x<span class="sc">^</span>a))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    vec <span class="ot">&lt;-</span> (x<span class="sc">^</span>a <span class="sc">&lt;</span> bound)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(a))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    out[vec] <span class="ot">&lt;-</span> <span class="fu">f_taylor</span>(a[vec])</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    out[<span class="sc">!</span>vec] <span class="ot">&lt;-</span> <span class="fu">f_not_taylor</span>(a[<span class="sc">!</span>vec])</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  f_deriv <span class="ot">&lt;-</span> \(a) {</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    f_deriv_not_taylor <span class="ot">&lt;-</span> \(a) {</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      x_a <span class="ot">&lt;-</span> x<span class="sc">^</span>a</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      delta_xa <span class="ot">&lt;-</span> <span class="fu">g</span>(x_a)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      log_y <span class="sc">-</span> log_x <span class="sc">*</span> log_delta <span class="sc">*</span> x_a <span class="sc">*</span> delta_xa <span class="sc">/</span> ((<span class="dv">1</span> <span class="sc">-</span> x_a) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> delta_xa))</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    f_deriv_taylor <span class="ot">&lt;-</span> \(a) {</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      x_a <span class="ot">&lt;-</span> x<span class="sc">^</span>a</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span>log_x <span class="sc">+</span> log_y <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> (log_delta <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> log_x <span class="sc">*</span> x_a</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    vec <span class="ot">&lt;-</span> (x<span class="sc">^</span>a <span class="sc">&lt;</span> bound)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(a))</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    out[vec] <span class="ot">&lt;-</span> <span class="fu">f_deriv_taylor</span>(a[vec])</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    out[<span class="sc">!</span>vec] <span class="ot">&lt;-</span> <span class="fu">f_deriv_not_taylor</span>(a[<span class="sc">!</span>vec])</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  minimum <span class="ot">&lt;-</span> .Machine<span class="sc">$</span>double.eps</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  a_to_b <span class="ot">&lt;-</span> \(a) {</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    x_a <span class="ot">&lt;-</span> x<span class="sc">^</span>a</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    attempt <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> x_a)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.infinite</span>(attempt)) {</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">/</span> x_a <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> x_a <span class="sc">/</span> <span class="dv">12</span> <span class="sc">+</span> x_a<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>      attempt</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(result, minimum)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  a0 <span class="ot">&lt;-</span> <span class="fu">log</span>(log_delta) <span class="sc">/</span> <span class="fu">log</span>(y <span class="sc">/</span> x)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(iter_lim)) {</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    a1_ <span class="ot">&lt;-</span> a0 <span class="sc">-</span> <span class="fu">f</span>(a0) <span class="sc">/</span> <span class="fu">f_deriv</span>(a0)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    a1 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.na</span>(a1_)) minimum <span class="cf">else</span> <span class="fu">max</span>(a1_, minimum)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    rel_error <span class="ot">&lt;-</span> (a0 <span class="sc">-</span> a1) <span class="sc">/</span> a1</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(rel_error) <span class="sc">&lt;</span> eps <span class="sc">|</span> a0 <span class="sc">==</span> minimum) <span class="cf">break</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    a0 <span class="ot">&lt;-</span> a1</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a =</span> a0, <span class="at">b =</span> <span class="fu">a_to_b</span>(a0))</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(result, <span class="st">"iter"</span>) <span class="ot">&lt;-</span> i</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<p>Let’s see how the function performs on an example:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_d4c10162bfffc3a30317862c304e7aa5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fl">0.55</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.90</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>matched <span class="ot">&lt;-</span> <span class="fu">matchkumar</span>(alpha, beta, x, y)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">x_matched =</span> extraDistr<span class="sc">::</span><span class="fu">qkumar</span>(alpha, matched[<span class="dv">1</span>], matched[<span class="dv">2</span>]),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_matched =</span> extraDistr<span class="sc">::</span><span class="fu">qkumar</span>(beta, matched[<span class="dv">1</span>], matched[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we see that the results are as intended:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_ecf51f8bbe3abdd8402878788cc5dc25">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x_matched y_matched 
     0.55      0.60 </code></pre>
</div>
</div>
<p>We typically do not need a large number of iterations; in this case it’s just 1!</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_4bc5a9b0ffde953409ad560d99470d86">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(matched, <span class="st">"iter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Here’s a plot of the resulting density.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_6932acc100a58d751fb1185a06cb55bc">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="performance" class="level2">
<h2 class="anchored" data-anchor-id="performance">Performance</h2>
<p>The example above is not sufficient to prove the method works. To verify a solution works, let’s check the squared distance between the implied quantiles and the desired quantiles.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_0de305d3a32eb06e2f33023e2f724c4e">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>verify <span class="ot">&lt;-</span> \(args) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> args[<span class="dv">3</span>]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> args[<span class="dv">4</span>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  matched <span class="ot">&lt;-</span> <span class="fu">matchkumar</span>(alpha, beta, x, y)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  x_matched <span class="ot">&lt;-</span> extraDistr<span class="sc">::</span><span class="fu">qkumar</span>(alpha, matched[<span class="dv">1</span>], matched[<span class="dv">2</span>])</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  y_matched <span class="ot">&lt;-</span> extraDistr<span class="sc">::</span><span class="fu">qkumar</span>(beta, matched[<span class="dv">1</span>], matched[<span class="dv">2</span>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> x_matched)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y <span class="sc">-</span> y_matched)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generating a bunch of random values here.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_e64b5ba3fee4e604263ee4d430be8a60">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">313</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">replicate</span>(n, <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">runif</span>(<span class="dv">2</span>)), <span class="fu">sort</span>(<span class="fu">runif</span>(<span class="dv">2</span>)))),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">apply</span>(args, <span class="dv">1</span>, verify)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results, <span class="at">log =</span> <span class="st">"y"</span>, <span class="at">ylab =</span> <span class="st">"Error"</span>, <span class="at">xlab =</span> <span class="st">"Index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="sources-of-problems" class="level3">
<h3 class="anchored" data-anchor-id="sources-of-problems">Sources of problems</h3>
<p>The function works very well for most randomly generated values, but not for absolutely all of them. Sadly, I don’t think it’s possible to solve this problem without using arbitrary precision numbers. For the problem lies not in the calculation of <span class="math inline">\(a\)</span> itself, which works very well, but in the calculation of <span class="math inline">\(b\)</span>. For some values of <span class="math inline">\(a\)</span> we are not able to calculate the value of <span class="math inline">\(b\)</span> sufficiently precisely using floating point arithmetic. Moreover, <code>extraDistr::qkumar</code> is not able to handle these extreme inputs. I strongly doubt this is would be a problem in practice, as the random values exhibiting these problems are quite unrealistic, and can be avoided altogether by scaling the Kumaraswamy distribution.</p>
<p>Consider the following.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_134d6b312c4140624aa8e49f81223958">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fl">0.6503457</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fl">0.6656772</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fl">0.2139453</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">=</span> <span class="fl">0.894129</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> are very close, but <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> far apart, which forces a large amount of mass in a very small space. In these cases <span class="math inline">\(a\)</span> appears to be calculated to great accuracy.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_8e7e80ac349a4184a33188189c0d1dcc">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>matched <span class="ot">=</span> <span class="fu">matchkumar</span>(alpha, beta, x, y)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>matched </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           a            b 
9.583478e+01 1.944493e+17 
attr(,"iter")
[1] 1</code></pre>
</div>
</div>
<p>But the exceedingly large <span class="math inline">\(a,b\)</span>s cannot be handled by the <code>extraDistr::qkumar</code>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_2fe27d969f754932a4261e4404400dc2">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">x_matched =</span> extraDistr<span class="sc">::</span><span class="fu">qkumar</span>(alpha, matched[<span class="dv">1</span>], matched[<span class="dv">2</span>]),</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_matched =</span> extraDistr<span class="sc">::</span><span class="fu">qkumar</span>(beta, matched[<span class="dv">1</span>], matched[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x_matched y_matched 
        0         0 </code></pre>
</div>
</div>
<p>Another sort of trouble-maker occurs when <span class="math inline">\(a\)</span> is too close to <span class="math inline">\(0\)</span>, i.e., closer than the machine epsilon.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_c13f04d151fe1725828349c51b7a0206">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fl">0.1383447</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fl">0.794063</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fl">0.9214318</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">=</span> <span class="fl">0.9266641</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s not a surprise that these values are hard to fit, as the <span class="math inline">\(x,y\)</span> values are far apart but <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> very, very, close. In this case, <code>matchkumar</code> yields</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_de1fc1da7fdf1352c8793103d81db617">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>matched <span class="ot">=</span> <span class="fu">matchkumar</span>(alpha,beta,x,y)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>matched</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           a            b 
2.220446e-16 7.195903e-02 
attr(,"iter")
[1] 11</code></pre>
</div>
</div>
<p>But the matched quantiles are not as close as we would like.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-13_a40ef44733a09cfb5ac4ba9e9061da13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">x_matched =</span> extraDistr<span class="sc">::</span><span class="fu">qkumar</span>(alpha, matched[<span class="dv">1</span>], matched[<span class="dv">2</span>]),</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_matched =</span> extraDistr<span class="sc">::</span><span class="fu">qkumar</span>(beta, matched[<span class="dv">1</span>], matched[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x_matched y_matched 
0.1353353 0.3678794 </code></pre>
</div>
</div>
<p>But as the Kumaraswamy distribution is parameterized, we can’t get the <span class="math inline">\(a\)</span> much closer to 0 than this.</p>
</section>
<section id="number-of-iterations" class="level3">
<h3 class="anchored" data-anchor-id="number-of-iterations">Number of iterations</h3>
<p>Most of the time, the number of iterations (capped at <span class="math inline">\(100\)</span>) is small. However, the cap is sometimes reached. In most cases, this is not cause for alarm. This is because we evaluate the solutions using the distance from the desired quantiles, but they are evaluated using the relative error in the Newton–Raphson loop. And the first will often be small even if the second is “large”. Moreover, the large numbers of iterations happens when <span class="math inline">\(a\)</span> is very, very small, which is unlikely to happen in applications.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_08708d459cd8186cf9edbd23a75a3163">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>